name: Deploy Easy Spaces to Power Platform

on:
  # Trigger on manual dispatch
  workflow_dispatch:
  
  # Trigger on push to main branch
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Install Power Platform Tools
      uses: microsoft/powerplatform-actions/actions-install@v1.9.1
        
    - name: Import Solution from Repository
      uses: microsoft/powerplatform-actions/import-solution@v1.9.1
      with:
        environment-url: 'https://org7cfbe420.crm.dynamics.com'
        app-id: ${{ secrets.POWERPLATFORM_APP_ID }}
        client-secret: ${{ secrets.POWERPLATFORM_CLIENT_SECRET }}
        tenant-id: ${{ secrets.POWERPLATFORM_TENANT_ID }}
        solution-file: 'out/EasySpacesWithEntities.zip'
        force-overwrite: true
        publish-changes: true